<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>小探探 MiniExplorer</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Screen management */
        .screen {
            display: none;
            height: 100%;
            flex-direction: column;
        }
        .screen.active {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HOME SCREEN -->
        <div id="screen-home" class="screen active home-screen">
            <div class="safe-area-top"></div>
            
            <header class="home-header">
                <h1 class="app-title">小探探 MiniExplorer</h1>
            </header>

            <div class="home-avatar">
                <div class="avatar-glow"></div>
                <div class="avatar-sphere">
                    <div class="avatar-face">😊</div>
                </div>
                <div class="avatar-greeting">你好呀！我是小探探</div>
            </div>

            <div class="home-actions">
                <div class="action-card" onclick="app.router.go('explore')">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                    </div>
                    <span class="action-label">看看这个（探索模式）</span>
                </div>

                <div class="action-card" onclick="app.router.go('companion')">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <span class="action-label">聊聊天（陪伴模式）</span>
                </div>
            </div>
            
            <div class="safe-area-bottom"></div>
        </div>

        <!-- EXPLORE SCREEN (Modified from prototype/explore.html) -->
        <div id="screen-explore" class="screen function-screen">
            <!-- Navbar -->
            <div class="nav-bar">
                <button class="nav-back" onclick="app.router.go('home')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
            </div>

            <!-- Main Area -->
            <div class="main-area">
                <div class="camera-fullscreen">
                    <video id="camera-preview" autoplay playsinline muted></video>
                    <!-- Viewfinder overlay -->
                    <div class="camera-viewfinder">
                        <div class="camera-corner tl"></div>
                        <div class="camera-corner tr"></div>
                        <div class="camera-corner bl"></div>
                        <div class="camera-corner br"></div>
                    </div>
                </div>

                <!-- AI Indicator -->
                <div class="ai-indicator">
                    <div class="ai-indicator-dot" id="explore-ai-dot">
                        <span class="avatar-face" id="explore-ai-face">😊</span>
                    </div>
                    <div class="ai-indicator-text" id="explore-status">对准想看的东西</div>
                </div>
            </div>

            <!-- Controls (button removed; only show subtle waves) -->
            <div class="control-bar" style="background: transparent; box-shadow: none;">
                <div class="sound-waves" id="explore-waves">
                    <div class="sound-wave"></div>
                    <div class="sound-wave"></div>
                    <div class="sound-wave"></div>
                </div>
            </div>

            <!-- Permission Overlay -->
            <div class="permission-overlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.25);backdrop-filter:blur(12px);z-index:999;">
              <div style="background:rgba(255,255,255,0.92);border-radius:24px;padding:24px 18px;max-width:320px;width:86%;text-align:center;box-shadow:0 16px 48px rgba(0,0,0,0.12);">
                <div style="font-weight:700;font-size:16px;margin-bottom:8px;">开始对话</div>
                <div style="font-size:13px;color:#556;line-height:1.4;margin-bottom:16px;">需要麦克风权限；相机可选（未授权也能聊天）。</div>
                <button class="main-btn idle" style="width:100%;">开始</button>
              </div>
            </div>

            <!-- Flash overlay -->
            <div class="flash-overlay" id="flash"></div>
        </div>

        <!-- COMPANION SCREEN (Modified from prototype/companion.html) -->
        <div id="screen-companion" class="screen function-screen">
            <div class="companion-bg"></div>
            
            <div class="nav-bar">
                <button class="nav-back" onclick="app.router.go('home')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
            </div>

            <!-- Front Camera PiP -->
            <div class="camera-pip">
                <!-- Placeholder if no camera -->
                <span class="camera-pip-placeholder">📷</span>
                <video id="companion-preview" autoplay playsinline muted style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;"></video>
            </div>

            <div class="main-area">
                <div class="companion-avatar">
                    <div class="companion-sphere" id="companion-sphere">
                        <div class="avatar-face" id="companion-face">😊</div>
                    </div>
                    <div class="companion-status" id="companion-status">想聊什么？</div>
                </div>
            </div>

            <div class="control-bar" style="background: transparent; box-shadow: none;">
                <div class="sound-waves" id="companion-waves">
                    <div class="sound-wave"></div>
                    <div class="sound-wave"></div>
                    <div class="sound-wave"></div>
                </div>
            </div>

            <!-- Permission Overlay -->
            <div class="permission-overlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.12);backdrop-filter:blur(12px);z-index:999;">
              <div style="background:rgba(255,255,255,0.92);border-radius:24px;padding:24px 18px;max-width:320px;width:86%;text-align:center;box-shadow:0 16px 48px rgba(0,0,0,0.10);">
                <div style="font-weight:700;font-size:16px;margin-bottom:8px;">开始对话</div>
                <div style="font-size:13px;color:#556;line-height:1.4;margin-bottom:16px;">需要麦克风权限；相机可选。</div>
                <button class="main-btn idle" style="width:100%;">开始</button>
              </div>
            </div>
        </div>
    </div>

    <!-- Hidden canvas for capture -->
    <canvas id="photo-canvas" style="display: none;"></canvas>

    <script type="module" src="js/main.js?v=handsfree-1"></script>
</body>
</html>
