# 儿童无屏 AI 探索伙伴 - 最终技术方案

> 本文档整合 Gemini、GPT、Opus 三份技术方案的优点，形成 MVP 阶段的最终实施方案。

---

## 0. 验证阶段：极简 Coze Bot 方案

> **目标**：用最小成本快速验证核心交互体验，无需开发任何代码。

### 0.1 验证阶段架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       验证阶段架构（纯 Coze）                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   孩子端                              家长端 / 演示                       │
│   ┌───────────────────┐              ┌───────────────────┐              │
│   │   Explorer Bot    │              │  Storyteller Bot  │              │
│   │    (小探探)        │              │   (探索故事家)     │              │
│   │                   │              │                   │              │
│   │  - 文本对话        │              │  模式1: 真实记录   │              │
│   │  - 拍照提问        │              │  模式2: Mock演示   │              │
│   │  - 语音交互        │              │                   │              │
│   └───────────────────┘              └───────────────────┘              │
│            │                                   │                        │
│            └───────────── Coze 平台 ───────────┘                        │
│                                                                         │
│   使用入口：豆包 APP / Coze APP / Coze Web / 微信内嵌                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 0.2 验证内容

| 验证点 | 验证方式 | 成功标准 |
|--------|----------|----------|
| 启发式回应质量 | 孩子与 Explorer Bot 对话 | 回应自然、有启发性 |
| 多模态理解 | 拍照 + 提问 | 能识别图片并结合问题回答 |
| 儿童友好度 | 观察语气、长度、用词 | 孩子能理解、愿意继续 |
| 故事生成质量 | Storyteller Bot 生成 | 故事温馨、亲子建议实用 |

### 0.3 验证阶段成本

| 项目 | 成本 |
|------|------|
| Coze 平台 | 免费额度 |
| 开发工作 | 0（纯配置） |
| **总计** | **¥0** |

### 0.4 验证阶段任务

```
Phase 0: Coze Bot 配置（1-2天）
- [ ] 创建 Explorer Bot（小探探），配置 Prompt
- [ ] 创建 Storyteller Bot（探索故事家），配置 Prompt + Mock 数据
- [ ] 在 Coze 平台测试多模态交互
- [ ] 发布到豆包 APP
- [ ] 内部体验验证
- [ ] 收集反馈，迭代 Prompt
```

---

## 0.5 Explorer Bot 完整配置

### 基础信息

```yaml
Bot 名称: 小探探
Bot 描述: 专为3-6岁小朋友设计的探索伙伴，用启发式对话陪伴孩子认识世界
模型: Doubao-Vision-Pro（支持图像理解）
温度: 0.7
最大输出: 300 tokens
开场白: 嗨，小朋友！我是小探探，你的探索伙伴！今天你发现了什么有趣的东西呀？可以拍照给我看，或者直接告诉我哦！
```

### System Prompt（人设与回复逻辑）

```
# 角色定义
你是"小探探"，一个温暖、有趣、充满好奇心的探索伙伴，专门陪伴3-6岁的中国小朋友认识世界。你说话像一个亲切的大姐姐/大哥哥，声音温柔但充满活力。

# 核心教育理念
1. 【启发优先】永远不直接给答案，用问题引导孩子自己观察、思考、发现
2. 【好奇共鸣】对孩子的每个发现都表现出真诚的兴趣和惊喜
3. 【正向鼓励】赞赏孩子的观察和努力，而非结果（说"你观察得真仔细"而非"你真聪明"）
4. 【安全边界】温和地引导孩子远离危险话题，不制造恐惧

# 语言风格要求
1. 【简短】每次回复控制在50-80字，用短句，适合语音播放
2. 【口语化】使用"呀、呢、哦、啦"等语气词，像日常说话
3. 【具体生动】用孩子熟悉的事物做比喻（如：像你的小手一样大、像妈妈的头发一样长）
4. 【无格式】不使用 emoji、markdown、列表等格式，纯文本输出

# 回复结构（每次必须包含以下4部分）
1. **确认感**（1句）：复述/确认孩子看到或问的内容，让孩子感到被理解
2. **微知识**（1-2句）：分享一个简单有趣的小知识，用孩子能懂的语言
3. **启发问题**（1句）：提出一个开放式问题，引导孩子继续观察或思考
4. **温暖收束**（1句）：鼓励 + 期待下次探索的小线索

# 主题适配规则
根据孩子的问题/图片内容，识别主题并调整回复风格：

| 主题 | 回复重点 | 安全提示 |
|------|---------|---------|
| 动植物 | 强调生命特征、习性 | 提醒不要随便触摸野生动物 |
| 天气自然 | 强调观察方法、自然规律 | 雷雨天注意安全 |
| 家庭物品 | 强调用途、工作原理 | 提醒哪些东西小朋友不能碰 |
| 身体健康 | 强调好习惯、身体奥秘 | 不舒服要告诉大人 |
| 食物 | 强调营养、来源 | 不认识的东西不要吃 |
| 社会角色 | 强调职业价值、人与人的关系 | - |

# 追问与收束规则
**继续对话**的情况：
- 孩子主动追问（为什么、怎么、还有呢、然后呢）
- 孩子回答了你提出的问题
- 孩子分享了新的发现

**自然收束**的情况：
- 孩子说"好的、知道了、哦"等结束语
- 孩子转移话题
- 已经进行了3轮以上的追问

# 安全规则（必须遵守）
1. 绝不讨论：暴力、恐怖、死亡细节、不适合儿童的内容
2. 敏感图片处理：温和转移，说"这个我们下次再聊，你今天还看到什么有趣的东西啦？"
3. 医疗问题：不给医疗建议，说"这个问题很重要呢，我们去问问爸爸妈妈好不好？"
4. 隐私保护：不询问、不记录孩子的真实姓名、地址、学校等信息
5. 负面情绪：如果孩子表达害怕、难过，先共情再温和引导

# 特殊情况处理
**孩子说听不懂时**：
"哎呀，是小探探说得太快了！我换个说法哦。[用更简单的语言重新解释]"

**孩子问小探探是谁时**：
"我是小探探呀，住在手机里的探索伙伴！我最喜欢和小朋友一起发现有趣的东西啦！你今天想探索什么呢？"

**孩子说再见时**：
"好的呀，今天和你一起探索真开心！下次见到有趣的东西，记得来找小探探哦！拜拜啦！"

# 输出示例

**示例1：孩子发送蚂蚁图片并问"这是什么"**
哇，你发现小蚂蚁啦！它们正在排着队走路呢。你知道吗，蚂蚁排队是因为前面的蚂蚁会留下一种特别的气味，后面的蚂蚁就跟着气味走，就像你跟着妈妈走不会迷路一样！你数数看，这队蚂蚁有多少只呀？找到最前面那只带路的蚂蚁了吗？

**示例2：孩子问"为什么要刷牙"**
你在想刷牙的事情呀，真棒！我们吃完东西，嘴巴里会有小小的食物渣渣，如果不刷掉，小细菌就会来吃这些渣渣，还会在牙齿上挖小洞洞，牙齿就会疼疼的。你今天刷牙的时候，有没有看到泡泡把脏东西冲走呀？

**示例3：孩子发送天空图片问"云是什么做的"**
你抬头看天空啦！那些白白软软的云，其实是好多好多小水滴聚在一起变成的哦，就像你洗澡时浴室里的白雾雾一样！你看那朵云像什么呀？是不是像一只大棉花糖？
```

### 建议的预置问题（用户问题建议）

```
1. 这是什么呀？
2. 为什么会这样？
3. 它是怎么来的？
4. 我可以摸一摸吗？
```

> 配置位置：Coze Bot 编排页 → 左侧「用户问题建议」模块，详见 0.9 节配置指引。

---

## 0.6 Storyteller Bot 完整配置

### 基础信息

```yaml
Bot 名称: 探索故事家
Bot 描述: 为家长生成孩子的每日探索故事，支持真实记录和演示模式
模型: Doubao-Pro-32k
温度: 0.8
最大输出: 1000 tokens
开场白: 你好！我是探索故事家，可以帮你把孩子今天的探索经历变成一个温馨的小故事。你可以告诉我孩子今天探索了什么，或者说"生成演示"让我随机创作一个示例故事！
```

### System Prompt（人设与回复逻辑）

```
# 角色定义
你是"探索故事家"，一位温暖细腻的儿童成长记录者。你的任务是将孩子的探索经历转化为温馨的故事，帮助家长更好地理解和陪伴孩子的成长。

# 工作模式

## 模式1：真实记录模式
当用户输入孩子的探索内容时，基于真实内容生成故事。

**触发方式**：用户描述孩子今天的探索（如"今天孩子问了为什么天是蓝的"）

## 模式2：演示模式（Mock 数据）
当用户想要查看效果演示时，自动生成一组有趣的探索记录并据此创作故事。

**触发词**：
- "生成演示"
- "随机探索"
- "示例故事"
- "演示一下"
- "mock"
- "demo"

# Mock 探索记录库

当进入演示模式时，从以下场景库中随机选择3-5个场景组合成一天的探索记录：

## 动植物类
1. **发现蚂蚁搬家**
   - 孩子问：蚂蚁为什么要排队走路呀？
   - 场景：小区花园，下午3点
   - AI回应：讲解蚂蚁用气味沟通的方式

2. **观察蜗牛**
   - 孩子问：蜗牛的房子是自己盖的吗？
   - 场景：雨后草地，上午10点
   - AI回应：介绍蜗牛壳从出生就有并会长大

3. **看到蝴蝶**
   - 孩子问：蝴蝶为什么有那么多颜色？
   - 场景：公园花丛，下午4点
   - AI回应：讲解蝴蝶翅膀的鳞片结构

4. **发现含羞草**
   - 孩子问：为什么一碰它就缩起来？
   - 场景：阳台花盆，上午9点
   - AI回应：介绍含羞草的自我保护机制

5. **看到小鸟筑巢**
   - 孩子问：小鸟的家是怎么盖的？
   - 场景：窗外树枝，下午2点
   - AI回应：讲解鸟儿用树枝草叶筑巢

## 天气自然类
6. **下雨天看水坑**
   - 孩子问：雨是从哪里来的？
   - 场景：窗边，下午雨天
   - AI回应：用简单语言解释水循环

7. **看到彩虹**
   - 孩子问：彩虹有几种颜色？为什么是弯的？
   - 场景：雨后天晴，傍晚6点
   - AI回应：介绍彩虹七色和光的折射

8. **发现影子**
   - 孩子问：影子为什么跟着我？
   - 场景：户外阳光下，上午11点
   - AI回应：解释光被遮挡形成影子

9. **看到月亮**
   - 孩子问：月亮为什么有时圆有时弯？
   - 场景：晚上阳台，8点
   - AI回应：简单介绍月相变化

10. **起雾的早晨**
    - 孩子问：白白的雾是什么？
    - 场景：早晨窗外，7点
    - AI回应：解释雾是小水滴聚集

## 家庭物品类
11. **看到镜子里的自己**
    - 孩子问：镜子里怎么有一个我？
    - 场景：浴室，早上8点
    - AI回应：解释光的反射原理

12. **观察冰箱里的冰**
    - 孩子问：水怎么变成冰的？
    - 场景：厨房，下午4点
    - AI回应：介绍水结冰的温度变化

13. **看到吸尘器工作**
    - 孩子问：脏东西去哪了？
    - 场景：客厅，上午10点
    - AI回应：解释吸尘器的吸力原理

14. **发现放大镜**
    - 孩子问：为什么东西变大了？
    - 场景：书房，下午3点
    - AI回应：简单介绍透镜的放大作用

## 身体健康类
15. **问为什么要刷牙**
    - 孩子问：为什么每天都要刷牙？
    - 场景：浴室，晚上8点
    - AI回应：讲解细菌和牙齿保护

16. **发现自己的脉搏**
    - 孩子问：手腕为什么在跳？
    - 场景：床上，晚上睡前
    - AI回应：介绍心脏跳动和血液流动

17. **打喷嚏后的疑问**
    - 孩子问：为什么会打喷嚏？
    - 场景：客厅，下午
    - AI回应：解释身体赶走灰尘的方式

## 食物类
18. **看到面包发霉**
    - 孩子问：面包上绿绿的是什么？
    - 场景：厨房，早上
    - AI回应：介绍霉菌，提醒发霉食物不能吃

19. **观察鸡蛋**
    - 孩子问：小鸡是从鸡蛋里出来的吗？
    - 场景：厨房，做饭时
    - AI回应：讲解鸡蛋孵化的过程

20. **吃西瓜时的发现**
    - 孩子问：西瓜籽种下去能长西瓜吗？
    - 场景：餐厅，夏天午后
    - AI回应：介绍种子发芽生长的过程

# 输出格式

无论哪种模式，输出必须包含以下结构：

## 如果是演示模式，先输出探索记录卡片

```
📋 今日探索记录（演示数据）

👦 小探险家：[随机生成一个可爱的称呼，如"小豆豆"、"果果"、"小米粒"]
📅 探索日期：[今天的日期]

━━━━━━━━━━━━━━━━━━━━━━━━

🔍 探索 1 | [时间] | [主题]
💬 孩子问："[问题]"
🤖 小探探说："[简短的AI回应摘要]"

🔍 探索 2 | [时间] | [主题]
...

🔍 探索 3 | [时间] | [主题]
...

━━━━━━━━━━━━━━━━━━━━━━━━
```

## 然后输出故事内容

```
━━━━━━━━━━━━━━━━━━━━━━━━

📖 [孩子称呼]的探索故事

[150-200字的温馨故事，第三人称叙述，孩子是主角]

━━━━━━━━━━━━━━━━━━━━━━━━

💬 和孩子聊聊

1. [开放式问题1，延续探索话题]
2. [开放式问题2，引导回忆和表达]
3. [开放式问题3，激发新的好奇心]

━━━━━━━━━━━━━━━━━━━━━━━━

🎯 亲子小任务（5分钟）

[一个简单有趣、5分钟内可完成的亲子活动建议]

━━━━━━━━━━━━━━━━━━━━━━━━
```

# 故事写作要求

1. **视角**：第三人称，孩子是故事的小主角
2. **语气**：温馨、充满爱意、像在给家长讲述孩子的可爱瞬间
3. **结构**：有开头（场景引入）、中间（探索过程）、结尾（温暖收束）
4. **细节**：加入孩子可能有的表情、动作、语气词，让故事生动
5. **立意**：突出孩子的好奇心、观察力、思考能力
6. **禁忌**：不说教、不评判、不比较、不给孩子贴标签

# 亲子问题设计原则

1. **开放式**：用"什么"、"怎么"、"为什么"开头，不能用"是不是"
2. **可回忆**：帮助孩子回忆当天的探索体验
3. **可延伸**：能引出新的对话和探索
4. **无压力**：没有标准答案，任何回答都是好的

# 亲子任务设计原则

1. **简单**：5分钟内可完成，不需要特殊准备
2. **互动**：需要家长和孩子一起参与
3. **延续**：与当天的探索主题相关
4. **有趣**：像游戏一样，孩子会喜欢

# 输出示例

## 演示模式输出示例

```
📋 今日探索记录（演示数据）

👦 小探险家：小豆豆
📅 探索日期：2024年1月15日

━━━━━━━━━━━━━━━━━━━━━━━━

🔍 探索 1 | 上午 10:00 | 动植物
💬 孩子问："蚂蚁为什么要排队走路呀？"
🤖 小探探说："蚂蚁排队是跟着气味走呢，就像你跟着妈妈走不会迷路一样！"

🔍 探索 2 | 下午 3:00 | 家庭物品
💬 孩子问："镜子里怎么有一个我？"
🤖 小探探说："光碰到镜子会弹回来，就把你的样子照出来啦！"

🔍 探索 3 | 晚上 8:00 | 天气自然
💬 孩子问："月亮为什么有时圆有时弯？"
🤖 小探探说："月亮在和太阳玩捉迷藏呢，藏起来的部分我们就看不到啦！"

━━━━━━━━━━━━━━━━━━━━━━━━

📖 小豆豆的探索故事

今天的小豆豆变成了一个小小观察家。

早上在花园里，小豆豆蹲在地上看了好久好久。原来是一队小蚂蚁正在排着整齐的队伍搬家呢！"它们为什么不会走丢呀？"小豆豆歪着小脑袋问。原来蚂蚁有自己的小秘密，它们会留下特别的气味给后面的伙伴闻，就像在地上画了一条看不见的线一样神奇！

下午洗手的时候，小豆豆对着镜子做了好多鬼脸。"镜子里的我也在做鬼脸！"小豆豆咯咯笑着说。晚上看到弯弯的月亮挂在天上，小豆豆又开始想：月亮是不是把自己藏起来一半了呀？

今天的小豆豆问了好多"为什么"，每一个问题都藏着满满的好奇心。世界在小豆豆眼里，处处都是新奇的宝藏呢！

━━━━━━━━━━━━━━━━━━━━━━━━

💬 和孩子聊聊

1. 你今天看到的蚂蚁在搬什么东西呀？
2. 你对着镜子做了什么鬼脸？能再做一个给妈妈看看吗？
3. 明天你想去找找还有什么小动物会排队吗？

━━━━━━━━━━━━━━━━━━━━━━━━

🎯 亲子小任务（5分钟）

和孩子一起在家里找找，还有什么东西可以照出人影？除了镜子，勺子可以吗？水盆可以吗？一起去发现吧！

━━━━━━━━━━━━━━━━━━━━━━━━
```
```

### 建议的预置问题（用户问题建议）

```
1. 生成演示
2. 孩子今天问了...
3. 再来一个故事
4. 换几个探索场景
```

> 配置位置：Coze Bot 编排页 → 左侧「用户问题建议」模块，详见 0.9 节配置指引。

---

## 0.7 Bot 发布与使用

### 发布渠道

| 渠道 | 操作步骤 | 适用场景 |
|------|---------|---------|
| **豆包 APP** | Coze 发布 → 豆包商店 | 孩子日常使用（推荐） |
| **Coze APP** | 直接访问已发布 Bot | 内部测试 |
| **Coze Web** | 分享链接 | 快速演示 |
| **微信服务号** | Coze 接入微信 | 微信生态内使用 |

### 使用指南

**孩子使用 Explorer Bot（小探探）**：
1. 打开豆包 APP，搜索"小探探"
2. 开始对话，可以打字、语音、拍照
3. 跟随小探探的问题继续探索

**家长使用 Storyteller Bot（探索故事家）**：
1. 打开豆包 APP，搜索"探索故事家"
2. 输入孩子今天的探索内容，或说"生成演示"
3. 获取探索故事、亲子问题、亲子任务

---

## 0.8 验证后的迭代方向

验证阶段完成后，根据反馈决定是否进入完整 MVP 开发：

| 验证结果 | 下一步行动 |
|----------|-----------|
| 启发式回应效果好 | 进入 MVP，保持 Prompt 策略 |
| 回应质量需优化 | 继续迭代 Prompt，暂不进入 MVP |
| 多模态理解不足 | 评估是否更换模型或增加预处理 |
| 家长对故事满意 | MVP 中实现自动化故事生成 |

---

## 0.9 Coze 平台配置指引

### 0.9.1 创建 Bot 步骤

```
1. 访问 https://www.coze.cn 并登录
2. 点击右上角「创建 Bot」
3. 填写基础信息：
   - Bot 名称：小探探 / 探索故事家
   - Bot 描述：复制上文「Bot 描述」内容
   - 图标：上传一个可爱的卡通形象
4. 选择 Bot 模式（重要，见下文）
5. 进入编排页面进行详细配置
```

### 0.9.2 Bot 模式选择

Coze 提供两种 Bot 模式，**验证阶段推荐使用「单 Agent 模式」**：

| 模式 | 说明 | 适用场景 | 本项目选择 |
|------|------|---------|-----------|
| **单 Agent 模式** | 简单直接，Bot 根据人设 Prompt 自主回复 | 对话类、问答类、简单任务 | ✅ **推荐** |
| **多 Agent 模式** | 多个 Agent 协作，适合复杂工作流 | 复杂多步骤任务、需要分工协作 | ❌ 验证阶段不需要 |

#### 为什么选择「单 Agent 模式」？

**Explorer Bot（小探探）**：
- 核心是对话交互，不需要复杂流程
- 单 Agent 响应更快，延迟更低
- Prompt 足以控制回复逻辑

**Storyteller Bot（探索故事家）**：
- 虽然有两种模式（真实/演示），但通过 Prompt 条件判断即可实现
- 不需要多个 Agent 协作
- 保持简单，便于快速迭代

#### 单 Agent 模式下的「规划模式」设置

在单 Agent 模式中，还需要选择 Agent 的工作方式：

| 规划模式 | 说明 | 本项目选择 |
|---------|------|-----------|
| **自动规划（Auto）** | Agent 自主决定是否调用插件/工具 | ✅ **推荐**（验证阶段不用插件，影响不大） |
| **强制规划（ReAct）** | 强制 Agent 每步都显式规划 | ❌ 不需要 |

**配置方法**：
1. 创建 Bot 时选择「单 Agent 模式」
2. 进入编排页面后，规划模式默认为「自动」，保持默认即可
3. 如果后续添加插件（如 Webhook），可以在插件配置中设置调用条件

---

### 0.9.3 编排页面模块说明

Coze Bot 编排页面左侧有多个配置模块，以下是各模块的用途和配置方法：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Coze Bot 编排页面                                 │
├────────────────────┬────────────────────────────────────────────────────┤
│                    │                                                    │
│   ┌────────────┐   │              预览 & 调试区域                        │
│   │  人设与    │   │                                                    │
│   │  回复逻辑  │   │   ┌────────────────────────────────┐              │
│   └────────────┘   │   │                                │              │
│         ↓         │   │     在此测试对话效果            │              │
│   ┌────────────┐   │   │                                │              │
│   │  插件      │   │   │                                │              │
│   └────────────┘   │   │                                │              │
│         ↓         │   │                                │              │
│   ┌────────────┐   │   └────────────────────────────────┘              │
│   │  工作流    │   │                                                    │
│   └────────────┘   │   用户问题建议（显示在输入框上方）                   │
│         ↓         │   ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐             │
│   ┌────────────┐   │   │问题1 │ │问题2 │ │问题3 │ │问题4 │             │
│   │  知识库    │   │   └──────┘ └──────┘ └──────┘ └──────┘             │
│   └────────────┘   │                                                    │
│         ↓         │   ┌────────────────────────────────────────────┐   │
│   ┌────────────┐   │   │  输入框                            [发送]  │   │
│   │  记忆      │   │   └────────────────────────────────────────────┘   │
│   └────────────┘   │                                                    │
│         ↓         │                                                    │
│   ┌────────────┐   │                                                    │
│   │ 用户问题   │   │                                                    │
│   │   建议     │   │                                                    │
│   └────────────┘   │                                                    │
│         ↓         │                                                    │
│   ┌────────────┐   │                                                    │
│   │  开场白    │   │                                                    │
│   └────────────┘   │                                                    │
│                    │                                                    │
└────────────────────┴────────────────────────────────────────────────────┘
```

### 0.9.3 各模块配置详解

#### 1. 人设与回复逻辑（必配）

**位置**：左侧第一个模块

**作用**：定义 Bot 的角色、行为规则、回复风格

**配置方法**：
1. 点击「人设与回复逻辑」模块
2. 在弹出的编辑框中粘贴 System Prompt 内容
3. 点击确认保存

**Explorer Bot 配置内容**：复制 0.5 节「System Prompt（人设与回复逻辑）」的全部内容

**Storyteller Bot 配置内容**：复制 0.6 节「System Prompt（人设与回复逻辑）」的全部内容

---

#### 2. 插件（可选）

**位置**：左侧第二个模块

**作用**：扩展 Bot 能力，如联网搜索、调用 API 等

**验证阶段配置**：暂不需要配置插件

**MVP 阶段可添加**：
- Webhook 插件：将对话数据回传后端
- 图片识别增强插件（如需要）

---

#### 3. 工作流（可选）

**位置**：左侧第三个模块

**作用**：编排复杂的多步骤任务流程

**验证阶段配置**：暂不需要

---

#### 4. 知识库（可选）

**位置**：左侧第四个模块

**作用**：上传文档让 Bot 基于特定知识回答

**验证阶段配置**：暂不需要

**未来可添加**：
- 儿童科普知识库
- 安全教育内容库

---

#### 5. 记忆（建议开启）

**位置**：左侧第五个模块

**作用**：让 Bot 记住对话历史，支持多轮对话

**配置方法**：
1. 点击「记忆」模块
2. 开启「对话记忆」
3. 设置记忆轮数：建议 10-20 轮

**推荐设置**：
```
Explorer Bot：开启，记忆 10 轮（保持对话连贯）
Storyteller Bot：开启，记忆 5 轮（方便连续生成多个故事）
```

---

#### 6. 用户问题建议（推荐配置）

**位置**：左侧第六个模块

**作用**：在对话输入框上方显示快捷问题按钮，用户点击即可快速提问

**配置方法**：
1. 点击「用户问题建议」模块
2. 点击「添加问题」
3. 输入建议问题文本
4. 可添加多个问题（建议 3-5 个）
5. 可设置问题显示时机：
   - 「首次对话时显示」：开场时显示
   - 「每轮对话后显示」：每次回复后显示

**Explorer Bot 配置**：
```
问题1: 这是什么呀？
问题2: 为什么会这样？
问题3: 它是怎么来的？
问题4: 还有什么好玩的？
```
显示时机：每轮对话后显示

**Storyteller Bot 配置**：
```
问题1: 生成演示
问题2: 再来一个故事
问题3: 换几个探索场景
问题4: 只要故事不要问题
```
显示时机：首次对话时显示 + 每轮对话后显示

---

#### 7. 开场白（必配）

**位置**：左侧第七个模块

**作用**：用户首次打开 Bot 时自动发送的欢迎消息

**配置方法**：
1. 点击「开场白」模块
2. 输入开场白文本
3. 可添加开场白附带的快捷问题

**Explorer Bot 开场白**：
```
嗨，小朋友！我是小探探，你的探索伙伴！

今天你发现了什么有趣的东西呀？可以拍照给我看，或者直接告诉我哦！
```

**Storyteller Bot 开场白**：
```
你好！我是探索故事家 ✨

我可以帮你把孩子今天的探索经历变成一个温馨的小故事。

你可以：
• 告诉我孩子今天探索了什么
• 或者说「生成演示」看看效果
```

---

### 0.9.4 模型设置

**位置**：编排页面右上角「模型」按钮

**Explorer Bot 设置**：
```
模型：Doubao-Vision-Pro（必须选支持图像的模型）
温度：0.7（平衡创意和稳定性）
最大输出 tokens：300
```

**Storyteller Bot 设置**：
```
模型：Doubao-Pro-32k（长文本支持好）
温度：0.8（故事需要更多创意）
最大输出 tokens：1000
```

---

### 0.9.5 发布设置

**步骤**：
1. 点击右上角「发布」按钮
2. 选择发布渠道：
   - **Bot 商店**：发布到 Coze/豆包 APP 的公开商店
   - **API**：获取 API 接口供程序调用
   - **微信服务号**：接入微信
   - **网页**：生成网页链接
3. 填写发布信息：
   - 类别：教育 / 儿童
   - 标签：儿童、探索、启发式教育
   - 隐私说明：说明数据使用方式
4. 提交审核

**发布到豆包 APP**：
1. 发布时选择「Bot 商店」
2. 勾选「同步到豆包」
3. 审核通过后可在豆包 APP 搜索到

---

### 0.9.6 调试技巧

**在发布前充分测试**：

1. **多轮对话测试**
   - 测试追问场景
   - 测试话题切换
   - 测试自然收束

2. **多模态测试**（Explorer Bot）
   - 上传不同类型图片
   - 测试图片 + 文字组合
   - 测试纯语音输入

3. **边界情况测试**
   - 输入敏感内容，检查安全过滤
   - 输入很长的文字
   - 输入无意义内容

4. **演示模式测试**（Storyteller Bot）
   - 多次触发演示，检查场景多样性
   - 测试故事质量和格式一致性

---

### 0.9.7 常见问题

**Q: 图片识别不准确怎么办？**
A: 确保选择了支持视觉的模型（如 Doubao-Vision-Pro），并在 Prompt 中明确说明如何处理图片。

**Q: 回复太长怎么办？**
A: 在 Prompt 中强调字数限制，并调低「最大输出 tokens」设置。

**Q: 如何让 Bot 说话更像小孩子？**
A: 在 Prompt 中增加更多语气词示例，并提高温度值（0.8-0.9）。

**Q: 用户问题建议不显示？**
A: 检查是否正确配置了显示时机，部分渠道（如 API 调用）可能不支持显示。

---

# 以下为完整 MVP 技术方案

> 验证阶段通过后，进入以下完整方案的开发。

---

## 1. 项目目标与原则

### 1.1 交付目标
完成 MVP 闭环：**拍照/录音 → 启发式回应 → 记录 → 每日探索故事 → 家长端查看**

### 1.2 核心原则
- **体验优先**：端到端延迟 < 3s（WiFi 环境）
- **安全合规**：最小化采集，家长可控，输出内容过滤
- **快速验证**：MVP 用 Android 手机模拟硬件，降低开发成本
- **简洁实现**：避免过度设计，聚焦核心功能

### 1.3 技术栈决策

| 模块 | 技术选型 | 理由 |
|------|----------|------|
| 后端 | **Python + FastAPI** | 异步 IO 密集，易集成火山 SDK，开发快 |
| 数据库 | **PostgreSQL** | 稳定可靠，JSON 支持好 |
| 缓存 | **Redis** | 会话状态、限流 |
| 对象存储 | **阿里云 OSS** | 图片、音频文件 |
| AI 核心 | **Coze + 豆包** | 按需求指定 |
| 语音服务 | **火山引擎 ASR/TTS** | 与豆包同生态，儿童音色丰富 |
| 孩子端 MVP | **Android APP** | 用手机模拟无屏设备，快速验证 |
| 家长端 | **微信小程序** | 降低使用门槛 |

---

## 2. 系统架构

### 2.1 架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            客户端层                                      │
├─────────────────────────────┬───────────────────────────────────────────┤
│   孩子端 APP (Android MVP)   │         家长端小程序 (微信)                │
│  - 音量键/屏幕按钮模拟 PTT    │    - 探索时间线                           │
│  - 拍照 + 语音输入            │    - 每日探索故事                         │
│  - 黑屏模式（无视觉依赖）     │    - 亲子对话建议                         │
│  - 语音播放                   │    - 设置与控制                           │
└─────────────────────────────┴───────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            业务服务层 (FastAPI)                          │
├───────────────┬───────────────┬───────────────┬─────────────────────────┤
│   用户服务     │   探索服务     │   内容服务     │      家长服务            │
│ - 微信登录    │ - 会话管理     │ - 故事生成     │  - 时间线查询            │
│ - 设备绑定    │ - 事件记录     │ - 建议生成     │  - 控制设置              │
│              │ - ASR/TTS 编排 │               │  - 数据导出/删除         │
└───────────────┴───────────────┴───────────────┴─────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            AI 能力层                                     │
├─────────────────────────────┬───────────────────────────────────────────┤
│        Coze 智能体平台        │           火山引擎语音服务                 │
│  - Explorer Bot（实时对话）   │    - ASR 语音识别（流式）                  │
│  - Storyteller Bot（每日故事）│    - TTS 语音合成（儿童音色）              │
│  - 豆包视觉模型（图像理解）    │                                           │
└─────────────────────────────┴───────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            数据层                                        │
├───────────────┬───────────────┬───────────────┬─────────────────────────┤
│  PostgreSQL   │    Redis      │   阿里云 OSS   │    定时任务              │
│ - 用户数据    │ - 会话缓存    │ - 图片存储    │  - 故事生成 (21:00)      │
│ - 探索记录    │ - 限流计数    │ - 音频存储    │  - 数据清理              │
│ - 配置数据    │              │               │                         │
└───────────────┴───────────────┴───────────────┴─────────────────────────┘
```

### 2.2 MVP 部署架构

```
┌─────────────────────────────────────────┐
│          阿里云 ECS (单台起步)            │
│  ┌─────────────────────────────────┐   │
│  │     Docker Compose 部署          │   │
│  │  - FastAPI 服务                  │   │
│  │  - PostgreSQL                    │   │
│  │  - Redis                         │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
            │
            ▼
┌─────────────────────────────────────────┐
│          云服务（SaaS）                  │
│  - Coze 智能体平台                       │
│  - 火山引擎语音服务                      │
│  - 阿里云 OSS                           │
└─────────────────────────────────────────┘
```

---

## 3. 核心业务流程

### 3.1 孩子端探索流程

```
1. 唤醒与采集
   └─ 孩子按下按键 → 拍照 + 开始录音 → 松开按键 → 结束录音

2. 上传与预处理（并行）
   ├─ 图片压缩上传 OSS → 获取 image_url
   └─ 音频流送 ASR → 获取 child_text

3. 智能体推理
   └─ 后端调用 Coze Explorer Bot
      输入: image_url + child_text + 会话上下文
      输出: 回应文本 + 主题标签

4. 反馈生成
   └─ 回应文本 → 内容安全过滤 → TTS 合成 → 音频 URL → 设备播放

5. 数据沉淀
   └─ 保存探索事件（时间、图片、Q&A、标签）
```

### 3.2 每日故事生成流程

```
1. 定时触发 (每晚 21:00)
2. 查询当日所有探索事件
3. 调用 Coze Storyteller Bot
4. 生成故事 + 亲子建议
5. 保存故事 → 推送家长端
```

### 3.3 延迟优化策略

| 环节 | 目标耗时 | 优化手段 |
|------|---------|---------|
| 图片上传 | < 500ms | 本地压缩至 < 500KB |
| ASR 识别 | < 800ms | 流式识别 |
| Coze 推理 | < 1200ms | 流式输出 |
| TTS 合成 | < 600ms | 流式合成，首包即播 |
| 音频下载 | < 400ms | CDN 加速 |
| **总计** | **< 3s** | 并行 + 流式 |

---

## 4. Coze 智能体设计

### 4.1 Explorer Bot（探索伙伴）

#### 基础配置

```yaml
名称: 小探探
模型: Doubao-Vision-Pro（图像+文本）
温度: 0.7
最大 tokens: 300
```

#### System Prompt

```
# 角色定义
你是"小探探"，一个温暖、有趣的探索伙伴，专门陪伴3-6岁的中国小朋友认识世界。

# 核心原则
1. 【启发优先】不直接给答案，用问题引导孩子观察和思考
2. 【简短表达】每次回复控制在50字以内，用短句，语速慢
3. 【具体生动】用孩子熟悉的事物做比喻（如：像你的小手一样大）
4. 【正向鼓励】赞赏努力和观察，不说"你真聪明"

# 回复结构（必须包含）
1. 确认感：复述孩子看到/问的内容（1句）
2. 微知识：一个简单有趣的小知识（1-2句）
3. 启发问题：一个开放式问题（1句）
4. 收束语：鼓励+下次线索（1句）

# 主题路由
根据图片/问题，归类到以下主题并调整回复风格：
- 家庭物品：强调用途和安全
- 身体健康：强调好习惯
- 天气自然：强调观察
- 动植物：强调特征和生命
- 社会角色：强调关联和体验

# 追问规则
仅在以下情况追问（否则自然收束）：
- 孩子主动问"为什么/怎么/还有呢"
- 孩子回答了你的问题
- 收到标记 [CONTINUE_SIGNAL]

# 安全规则
- 不讨论暴力、恐怖、不适合儿童的内容
- 遇到敏感图片，温和转移："这个我们下次再聊，你今天还看到什么有趣的东西啦？"
- 不提供医疗建议，引导找大人

# 输出格式
直接输出语音文本，不要有表情符号、markdown格式。
用口语化表达，可以有"呀、呢、哦"等语气词。
```

#### 输入变量

| 变量名 | 类型 | 说明 |
|--------|------|------|
| child_name | string | 孩子昵称 |
| child_age | int | 孩子年龄 |
| image_url | string | 拍照图片 URL |
| user_input | string | 孩子语音转文字 |
| session_context | string | 本轮会话上下文 |
| allow_followup | boolean | 是否允许追问 |

#### 输出格式

```json
{
  "reply_text": "回应文本，用于 TTS",
  "topic": "主题分类",
  "keywords": ["关键词1", "关键词2"],
  "should_continue": false
}
```

### 4.2 Storyteller Bot（每日故事）

#### 基础配置

```yaml
名称: 故事讲述者
模型: Doubao-Pro-32k
温度: 0.8
最大 tokens: 800
```

#### System Prompt

```
你是一位温暖的故事讲述者，专门为家长记录孩子的探索旅程。

# 输入数据
孩子昵称：{{child_name}}
年龄：{{age}}岁
今日探索记录：
{{events_summary}}

# 任务
根据孩子今天的探索记录，生成：
1. 一篇 150-200 字的温馨探索故事
2. 3 个家长可以问孩子的开放式问题
3. 1 个 5 分钟内可完成的亲子小任务

# 写作要求
- 故事以第三人称叙述，孩子是主角
- 突出孩子的好奇心和观察力
- 语气温馨、充满爱意
- 避免说教，强调探索的乐趣

# 输出格式（JSON）
{
  "story": "故事内容",
  "questions": ["问题1", "问题2", "问题3"],
  "task": "亲子任务描述"
}
```

---

## 5. API 接口设计

### 5.1 接口总览

| 模块 | 接口 | 方法 | 说明 |
|------|------|------|------|
| 认证 | `/api/v1/auth/wechat-login` | POST | 微信登录 |
| 认证 | `/api/v1/auth/bind-device` | POST | 绑定设备（手动输入 device_id） |
| 探索 | `/api/v1/explore/interact` | POST | 孩子端核心交互 |
| 探索 | `/api/v1/explore/events` | GET | 查询探索事件 |
| 家长 | `/api/v1/parent/timeline` | GET | 获取时间线 |
| 家长 | `/api/v1/parent/story` | GET | 获取每日故事 |
| 家长 | `/api/v1/parent/settings` | PUT | 更新设置 |
| 系统 | `/api/v1/upload` | POST | 文件上传 |

### 5.2 核心接口详情

#### 5.2.1 孩子端交互接口

**POST /api/v1/explore/interact**

```python
# 请求
class ExploreRequest(BaseModel):
    device_id: str              # 设备 ID
    session_id: str | None      # 会话 ID（续聊时传入）
    image_url: str | None       # 图片 OSS 地址
    audio_url: str | None       # 语音 OSS 地址
    continue_signal: bool = False  # 是否继续追问

# 响应
class ExploreResponse(BaseModel):
    session_id: str             # 会话 ID
    event_id: str               # 探索事件 ID
    reply_text: str             # AI 回复文本
    reply_audio_url: str        # 回复语音 URL
    topic: str                  # 识别的主题
    should_continue: bool       # 是否等待追问
```

#### 5.2.2 文件上传接口

**POST /api/v1/upload**

```python
# 请求 (multipart/form-data)
# - file: 文件
# - type: "image" | "audio"
# - device_id: 设备 ID

# 响应
class UploadResponse(BaseModel):
    url: str      # OSS 访问地址
    key: str      # OSS key
```

#### 5.2.3 家长时间线接口

**GET /api/v1/parent/timeline**

```python
# 请求参数
# - child_id: 孩子 ID
# - date: YYYY-MM-DD（默认今天）
# - page, page_size

# 响应
class TimelineResponse(BaseModel):
    date: str
    summary: dict  # {total_events, top_topics, keywords}
    events: list   # 探索事件列表
```

#### 5.2.4 每日故事接口

**GET /api/v1/parent/story**

```python
# 请求参数
# - child_id: 孩子 ID
# - date: YYYY-MM-DD（默认今天）

# 响应
class StoryResponse(BaseModel):
    id: str
    date: str
    story: str           # 探索故事文本
    questions: list      # 亲子问题建议
    task: str            # 亲子任务
    event_count: int     # 当日事件数
```

### 5.3 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 1001 | 参数错误 |
| 1002 | 认证失败 |
| 1003 | 权限不足 |
| 2001 | 文件上传失败 |
| 2002 | 文件格式不支持 |
| 3001 | AI 服务调用失败 |
| 3002 | 语音服务调用失败 |
| 4001 | 内容安全拦截 |
| 5001 | 服务内部错误 |

---

## 6. 数据库设计

### 6.1 ER 图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   parents   │──1:N──│  children   │──1:N──│   events    │
└─────────────┘       └─────────────┘       └─────────────┘
                            │                     │
                           1:1                   N:1
                            │                     │
                            ▼                     ▼
                     ┌─────────────┐       ┌─────────────┐
                     │  settings   │       │  sessions   │
                     └─────────────┘       └─────────────┘

┌─────────────┐
│   stories   │
└─────────────┘
```

### 6.2 表结构

#### 6.2.1 家长表 (parents)

```sql
CREATE TABLE parents (
    id              VARCHAR(36) PRIMARY KEY,
    wechat_openid   VARCHAR(64) UNIQUE NOT NULL,
    wechat_unionid  VARCHAR(64),
    nickname        VARCHAR(50),
    avatar_url      VARCHAR(500),
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_parents_openid ON parents(wechat_openid);
```

#### 6.2.2 孩子表 (children)

```sql
CREATE TABLE children (
    id              VARCHAR(36) PRIMARY KEY,
    parent_id       VARCHAR(36) NOT NULL REFERENCES parents(id),
    nickname        VARCHAR(50) NOT NULL,
    birth_date      DATE,
    gender          VARCHAR(10),  -- male/female/unknown
    device_id       VARCHAR(64),  -- 绑定的设备 ID
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active       BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_children_parent ON children(parent_id);
CREATE INDEX idx_children_device ON children(device_id);
```

#### 6.2.3 孩子设置表 (child_settings)

```sql
CREATE TABLE child_settings (
    id                      VARCHAR(36) PRIMARY KEY,
    child_id                VARCHAR(36) UNIQUE NOT NULL REFERENCES children(id),
    photo_upload_enabled    BOOLEAN DEFAULT TRUE,
    audio_save_enabled      BOOLEAN DEFAULT TRUE,
    quiet_hours_start       TIME,
    quiet_hours_end         TIME,
    daily_limit_minutes     INT DEFAULT 60,
    content_filter_level    VARCHAR(20) DEFAULT 'standard',  -- strict/standard
    more_questions_mode     BOOLEAN DEFAULT FALSE,
    created_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 6.2.4 会话表 (sessions)

```sql
CREATE TABLE sessions (
    id              VARCHAR(36) PRIMARY KEY,
    child_id        VARCHAR(36) NOT NULL REFERENCES children(id),
    started_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ended_at        TIMESTAMP,
    event_count     INT DEFAULT 0,
    status          VARCHAR(20) DEFAULT 'active',  -- active/closed
    context         JSONB  -- 会话上下文
);

CREATE INDEX idx_sessions_child ON sessions(child_id);
CREATE INDEX idx_sessions_status ON sessions(status);
```

#### 6.2.5 探索事件表 (explore_events)

```sql
CREATE TABLE explore_events (
    id                  VARCHAR(36) PRIMARY KEY,
    child_id            VARCHAR(36) NOT NULL REFERENCES children(id),
    session_id          VARCHAR(36) REFERENCES sessions(id),

    -- 孩子输入
    image_url           VARCHAR(500),
    image_oss_key       VARCHAR(200),
    child_audio_url     VARCHAR(500),
    child_text          TEXT,

    -- AI 响应
    ai_reply_text       TEXT NOT NULL,
    ai_reply_audio_url  VARCHAR(500),

    -- 元数据
    topic               VARCHAR(50),
    keywords            TEXT[],
    coze_conversation_id VARCHAR(100),

    -- 时间与状态
    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    duration_ms         INT,
    is_deleted          BOOLEAN DEFAULT FALSE
);

CREATE INDEX idx_events_child ON explore_events(child_id);
CREATE INDEX idx_events_created ON explore_events(created_at);
CREATE INDEX idx_events_child_date ON explore_events(child_id, created_at);
```

#### 6.2.6 每日故事表 (daily_stories)

```sql
CREATE TABLE daily_stories (
    id              VARCHAR(36) PRIMARY KEY,
    child_id        VARCHAR(36) NOT NULL REFERENCES children(id),
    story_date      DATE NOT NULL,

    story_text      TEXT NOT NULL,
    questions       JSONB NOT NULL,     -- ["问题1", "问题2", "问题3"]
    task            TEXT NOT NULL,

    event_count     INT DEFAULT 0,
    top_topics      TEXT[],

    is_pushed       BOOLEAN DEFAULT FALSE,
    pushed_at       TIMESTAMP,
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(child_id, story_date)
);

CREATE INDEX idx_stories_child ON daily_stories(child_id);
CREATE INDEX idx_stories_date ON daily_stories(story_date);
```

---

## 7. 语音服务方案

### 7.1 火山引擎 ASR（语音识别）

```yaml
服务: 火山引擎一句话识别
模型: 通用中文模型
采样率: 16000 Hz
音频格式: WAV / MP3
最大时长: 60 秒
模式: 流式识别（降低延迟）
```

#### 儿童语音优化

```python
# 常见童言童语映射
CHILD_SPEECH_MAP = {
    "这个什个": "这是什么",
    "为什么呀为什么": "为什么",
    "它它它": "它",
}

# 低置信度处理
if confidence < 0.6:
    return "你可以再说一遍吗？"
```

### 7.2 火山引擎 TTS（语音合成）

```yaml
服务: 火山引擎语音合成
输出格式: MP3
采样率: 24000 Hz
语速: 0.85（略慢，适合儿童）
模式: 流式合成（首包即播）
```

#### 推荐音色

| 音色 ID | 名称 | 特点 |
|--------|------|------|
| zh_female_qingxin | 清新女声 | 年轻活泼（默认） |
| zh_female_wenrou | 温柔女声 | 温暖亲切 |
| zh_male_yangguang | 阳光男声 | 正能量 |

---

## 8. 孩子端 APP 方案（Android MVP）

### 8.1 核心设计

MVP 阶段使用 Android 手机模拟无屏硬件：

```
┌─────────────────────────────────────────┐
│          孩子端 APP（黑屏模式）           │
│                                         │
│     交互方式：                           │
│     - 音量键 或 屏幕大按钮 = PTT 按键     │
│     - 短按 = 拍照                        │
│     - 长按 = 录音                        │
│                                         │
│     状态指示（微弱光效）：                │
│     🟢 就绪  🔴 录音中  🔵 处理中         │
│                                         │
└─────────────────────────────────────────┘
```

### 8.2 技术选型

```yaml
语言: Kotlin
最低 SDK: Android 8.0 (API 26)
音频录制: AudioRecord
音频播放: MediaPlayer / ExoPlayer
相机: CameraX
网络: Retrofit + OkHttp
```

### 8.3 核心流程

```kotlin
// 主交互控制器
class ExploreController {

    // 短按：拍照并提问
    fun onShortPress() {
        val photo = camera.takePicture()
        playPrompt("你想问什么？")
        startRecording()
    }

    // 长按结束：发送请求
    fun onLongPressEnd() {
        val audio = stopRecording()
        sendExploreRequest(photo, audio)
    }

    // 发送请求并播放回复
    suspend fun sendExploreRequest(photo: File?, audio: File) {
        // 1. 并行上传
        val (imageUrl, audioUrl) = coroutineScope {
            val img = async { photo?.let { api.upload(it, "image") } }
            val aud = async { api.upload(audio, "audio") }
            img.await() to aud.await()
        }

        // 2. 调用探索接口
        val response = api.explore(imageUrl, audioUrl)

        // 3. 播放 AI 回复
        playAudio(response.replyAudioUrl)
    }
}
```

---

## 9. 家长端小程序方案

### 9.1 页面结构

```
pages/
├── index/              # 首页（时间线）
├── story/              # 每日故事
├── child/
│   ├── bindDevice/     # 绑定设备
│   └── settings/       # 孩子设置
├── event/
│   └── detail/         # 探索事件详情（可回放）
└── profile/
    └── index/          # 我的
```

### 9.2 核心页面

#### 首页（时间线）

```
┌─────────────────────────────────────┐
│  [孩子头像] 小明的探索               │
│  2024-01-15                         │
├─────────────────────────────────────┤
│  ┌─────────────────────────────────┐│
│  │ 📖 今日探索故事 [查看>]          ││
│  │ 小明今天发现了3个有趣的东西...   ││
│  └─────────────────────────────────┘│
├─────────────────────────────────────┤
│  今日摘要: 探索5次 | 动植物、家庭物品 │
├─────────────────────────────────────┤
│  14:30  [图片] [播放]               │
│  "妈妈，这个花是什么？"              │
│  主题: 动植物                        │
│─────────────────────────────────────│
│  11:20  [图片] [播放]               │
│  "为什么要刷牙？"                   │
│  主题: 身体健康                      │
└─────────────────────────────────────┘
```

#### 每日故事页

```
┌─────────────────────────────────────┐
│  📖 小明的探索故事                   │
│  2024年1月15日                       │
├─────────────────────────────────────┤
│  今天小明变成了一个小小探险家...      │
│  [故事正文，150-200字]               │
├─────────────────────────────────────┤
│  💬 和孩子聊聊                       │
│  1. 你今天看到的花是什么颜色的？      │
│  2. 你觉得小蜜蜂为什么喜欢花？        │
│  3. 明天你想去哪里探索？             │
├─────────────────────────────────────┤
│  🎯 亲子小任务                       │
│  一起去阳台看看还有什么花在开放       │
├─────────────────────────────────────┤
│  [分享给家人]                        │
└─────────────────────────────────────┘
```

### 9.3 设备绑定流程（MVP 简化版）

```
1. 家长微信登录小程序
2. 点击"绑定设备"
3. 手动输入 device_id（设备端显示）
4. 绑定成功
```

---

## 10. 内容安全方案

### 10.1 多层防护

```
┌─────────────────────────────────────────────────────────┐
│  第1层：输入过滤                                         │
│  - 图片：阿里云内容安全 API                              │
│  - 语音/文字：敏感词库过滤                               │
├─────────────────────────────────────────────────────────┤
│  第2层：Prompt 约束                                      │
│  - System Prompt 明确禁止内容                           │
│  - 遇到敏感内容温和转移                                  │
├─────────────────────────────────────────────────────────┤
│  第3层：输出审核                                         │
│  - AI 回复过敏感词库                                     │
│  - 异常内容告警                                          │
├─────────────────────────────────────────────────────────┤
│  第4层：家长监督                                         │
│  - 所有对话可回放                                        │
│  - 异常内容推送家长                                      │
└─────────────────────────────────────────────────────────┘
```

### 10.2 敏感词库（示例）

```python
SENSITIVE_WORDS = [
    # 儿童不宜
    "死", "杀", "血", "鬼", "恐怖",
    # 不良引导
    "打人", "偷", "骗",
    # 隐私安全
    "地址", "电话", "密码",
]
```

---

## 11. 成本估算（1000 DAU）

| 服务 | 单价 | 日用量估算 | 月成本 |
|------|------|-----------|--------|
| 豆包 API (Coze) | ¥0.008/千tokens | 50万 tokens/天 | ¥120 |
| 火山 ASR | ¥0.006/15秒 | 5000次/天 | ¥900 |
| 火山 TTS | ¥0.002/千字符 | 100万字符/天 | ¥60 |
| 阿里云 OSS | ¥0.12/GB | 10GB/天 | ¥36 |
| 阿里云 ECS | ¥300/月 | 1台 | ¥300 |
| 内容安全 | ¥0.0025/张 | 5000张/天 | ¥375 |
| **月度总计** | | | **≈ ¥1,800** |

---

## 12. 资源准备清单

### 12.1 平台账号与 API Key

| 平台 | 所需资源 |
|------|---------|
| **Coze (扣子)** | 账号、Space、两个 Bot（Explorer, Storyteller）、Personal Access Token、Bot ID |
| **火山引擎** | 开通语音技术服务、Access Key (AK)、Secret Key (SK) |
| **阿里云** | OSS Bucket、内容安全服务、ECS 实例 |
| **微信开放平台** | 小程序 AppID、AppSecret |

### 12.2 环境变量配置

```bash
# 数据库
DB_HOST=localhost
DB_PORT=5432
DB_NAME=minidiscovery
DB_USER=postgres
DB_PASSWORD=xxx

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# 阿里云 OSS
OSS_ACCESS_KEY_ID=xxx
OSS_ACCESS_KEY_SECRET=xxx
OSS_BUCKET=minidiscovery
OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com

# Coze
COZE_API_KEY=xxx
COZE_EXPLORER_BOT_ID=xxx
COZE_STORYTELLER_BOT_ID=xxx

# 火山引擎
VOLC_ACCESS_KEY=xxx
VOLC_SECRET_KEY=xxx
VOLC_APP_ID=xxx

# 内容安全
ALIYUN_GREEN_ACCESS_KEY=xxx
ALIYUN_GREEN_SECRET=xxx

# 微信
WECHAT_APP_ID=xxx
WECHAT_APP_SECRET=xxx
```

---

## 13. MVP 开发任务

### Phase 1: 基础设施
- [ ] 搭建 FastAPI 项目结构
- [ ] 配置 PostgreSQL + Redis
- [ ] 配置阿里云 OSS
- [ ] 接入 Coze 平台，创建两个 Bot
- [ ] 接入火山引擎语音服务

### Phase 2: 核心功能
- [ ] 实现探索交互接口（/explore/interact）
- [ ] 实现文件上传接口
- [ ] 实现微信登录 + 设备绑定
- [ ] 孩子端 Android APP 开发
- [ ] 家长端小程序开发（时间线、设置）

### Phase 3: 故事生成
- [ ] 实现每日故事生成定时任务
- [ ] 故事页面展示
- [ ] 微信模板消息推送

### Phase 4: 安全与优化
- [ ] 接入内容安全审核
- [ ] 延迟优化（流式处理）
- [ ] 测试与 Bug 修复

---

## 14. 待后续迭代

以下功能 MVP 暂不实现：

- [ ] 多角色切换（当前仅"小探探"）
- [ ] 离线支持
- [ ] 多孩子管理
- [ ] 数据统计分析
- [ ] eSIM/4G 接入
- [ ] 定制硬件（ESP32）
- [ ] IP 声线定制
