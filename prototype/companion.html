<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>å°æ¢æ¢ - èŠå¤©</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- å®‰å…¨åŒºåŸŸé¡¶éƒ¨ -->
    <div class="safe-area-top"></div>

    <!-- åŠŸèƒ½ç•Œé¢ -->
    <div class="function-screen">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <div class="nav-bar">
        <button class="nav-back" onclick="goHome()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
      </div>

      <!-- ä¸»å†…å®¹åŒº -->
      <div class="main-area">
        <!-- èƒŒæ™¯ -->
        <div class="companion-bg"></div>

        <!-- å‰ç½®ç›¸æœºé¢„è§ˆ -->
        <div class="camera-pip">
          <span class="camera-pip-placeholder">ğŸ‘¶</span>
        </div>

        <!-- AI å½¢è±¡ -->
        <div class="companion-avatar">
          <div class="companion-sphere" id="aiSphere">
            <span class="avatar-face" id="aiFace">ğŸ˜Š</span>
          </div>

          <!-- å£°æ³¢ -->
          <div class="sound-waves" id="soundWaves">
            <div class="sound-wave"></div>
            <div class="sound-wave"></div>
            <div class="sound-wave"></div>
          </div>

          <div class="companion-status" id="status">ä½ å¥½å‘€ï¼</div>
        </div>
      </div>

      <!-- åº•éƒ¨æ§åˆ¶ -->
      <div class="control-bar">
        <button class="main-btn idle" id="mainBtn" onclick="handleAction()">
          <span class="main-btn-icon" id="btnIcon">ğŸ¤</span>
          <span id="btnText">å¼€å§‹èŠå¤©</span>
        </button>
      </div>
    </div>

    <!-- å®‰å…¨åŒºåŸŸåº•éƒ¨ -->
    <div class="safe-area-bottom"></div>
  </div>

  <script>
    const State = {
      IDLE: 'idle',
      LISTENING: 'listening',
      SPEAKING: 'speaking',
      ENDING: 'ending'
    };

    let currentState = State.IDLE;
    let isActive = false;

    const mainBtn = document.getElementById('mainBtn');
    const btnIcon = document.getElementById('btnIcon');
    const btnText = document.getElementById('btnText');
    const aiSphere = document.getElementById('aiSphere');
    const aiFace = document.getElementById('aiFace');
    const status = document.getElementById('status');
    const soundWaves = document.getElementById('soundWaves');

    const config = {
      [State.IDLE]: {
        icon: 'ğŸ¤',
        text: 'å¼€å§‹èŠå¤©',
        btnClass: 'idle',
        face: 'ğŸ˜Š',
        status: 'ä½ å¥½å‘€ï¼',
        sphereClass: ''
      },
      [State.LISTENING]: {
        icon: 'ğŸµ',
        text: 'å¬ç€å‘¢...',
        btnClass: 'listening',
        face: 'ğŸ˜®',
        status: 'æˆ‘åœ¨è®¤çœŸå¬',
        sphereClass: 'listening'
      },
      [State.SPEAKING]: {
        icon: 'ğŸ’¬',
        text: 'è¯·ç¨ç­‰',
        btnClass: 'speaking',
        face: 'ğŸ¥°',
        status: 'è®©æˆ‘æƒ³æƒ³...',
        sphereClass: 'speaking'
      },
      [State.ENDING]: {
        icon: 'ğŸ‘‹',
        text: 'ç»“æŸèŠå¤©',
        btnClass: 'ending',
        face: 'ğŸ˜Š',
        status: 'å†ç‚¹ä¸€ä¸‹è¯´æ‹œæ‹œ',
        sphereClass: ''
      }
    };

    function setState(state) {
      currentState = state;
      const c = config[state];

      mainBtn.className = `main-btn ${c.btnClass}`;
      btnIcon.textContent = c.icon;
      btnText.textContent = c.text;
      aiFace.textContent = c.face;
      status.textContent = c.status;

      // AI çƒä½“çŠ¶æ€
      aiSphere.className = 'companion-sphere';
      if (c.sphereClass) aiSphere.classList.add(c.sphereClass);

      // å£°æ³¢
      soundWaves.classList.toggle('active', state === State.LISTENING);

      // è§¦è§‰åé¦ˆ
      if ('vibrate' in navigator) {
        if (state === State.LISTENING) navigator.vibrate(30);
        if (state === State.SPEAKING) navigator.vibrate([15, 20, 15]);
      }
    }

    function handleAction() {
      if (!isActive) {
        // å¼€å§‹èŠå¤©
        isActive = true;
        setState(State.LISTENING);

        // æ¨¡æ‹Ÿå¯¹è¯
        setTimeout(() => {
          setState(State.SPEAKING);
          setTimeout(() => setState(State.LISTENING), 3000);
        }, 3000);

      } else if (currentState === State.ENDING) {
        // ç¡®è®¤ç»“æŸ
        isActive = false;
        setState(State.IDLE);
      } else {
        // å‡†å¤‡ç»“æŸ
        setState(State.ENDING);
      }
    }

    function goHome() {
      if ('vibrate' in navigator) navigator.vibrate(15);
      window.location.href = 'index.html';
    }

    // åˆå§‹åŒ–
    setState(State.IDLE);
  </script>
</body>
</html>
