<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>å°æ¢æ¢ - çœ‹çœ‹</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- å®‰å…¨åŒºåŸŸé¡¶éƒ¨ -->
    <div class="safe-area-top"></div>

    <!-- åŠŸèƒ½ç•Œé¢ -->
    <div class="function-screen">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <div class="nav-bar">
        <button class="nav-back" onclick="goHome()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
      </div>

      <!-- ç›¸æœºå…¨å± -->
      <div class="main-area">
        <div class="camera-fullscreen">
          <!-- å–æ™¯æ¡† -->
          <div class="camera-viewfinder">
            <div class="camera-corner tl"></div>
            <div class="camera-corner tr"></div>
            <div class="camera-corner bl"></div>
            <div class="camera-corner br"></div>
          </div>
        </div>

        <!-- AI çŠ¶æ€æŒ‡ç¤º -->
        <div class="ai-indicator">
          <div class="ai-indicator-dot" id="aiDot">
            <span class="avatar-face" id="aiFace">ğŸ˜Š</span>
          </div>
          <div class="ai-indicator-text" id="aiText">å¯¹å‡†æƒ³çœ‹çš„ä¸œè¥¿</div>
        </div>
      </div>

      <!-- åº•éƒ¨æ§åˆ¶ -->
      <div class="control-bar">
        <button class="main-btn idle" id="mainBtn" onclick="handleAction()">
          <span class="main-btn-icon" id="btnIcon">ğŸ¤</span>
          <span id="btnText">å¼€å§‹å¯¹è¯</span>
        </button>
      </div>
    </div>

    <!-- å®‰å…¨åŒºåŸŸåº•éƒ¨ -->
    <div class="safe-area-bottom"></div>

    <!-- é—ªå…‰æ•ˆæœ -->
    <div class="flash-overlay" id="flash"></div>
  </div>

  <script>
    const State = {
      IDLE: 'idle',
      LISTENING: 'listening',
      SPEAKING: 'speaking',
      ENDING: 'ending'
    };

    let currentState = State.IDLE;
    let isActive = false;

    const mainBtn = document.getElementById('mainBtn');
    const btnIcon = document.getElementById('btnIcon');
    const btnText = document.getElementById('btnText');
    const aiDot = document.getElementById('aiDot');
    const aiFace = document.getElementById('aiFace');
    const aiText = document.getElementById('aiText');
    const flash = document.getElementById('flash');

    const config = {
      [State.IDLE]: {
        icon: 'ğŸ¤',
        text: 'å¼€å§‹å¯¹è¯',
        btnClass: 'idle',
        face: 'ğŸ˜Š',
        hint: 'å¯¹å‡†æƒ³çœ‹çš„ä¸œè¥¿'
      },
      [State.LISTENING]: {
        icon: 'ğŸµ',
        text: 'å¬ç€å‘¢...',
        btnClass: 'listening',
        face: 'ğŸ˜®',
        hint: 'æˆ‘åœ¨å¬'
      },
      [State.SPEAKING]: {
        icon: 'ğŸ’¬',
        text: 'è¯·ç¨ç­‰',
        btnClass: 'speaking',
        face: 'ğŸ¥°',
        hint: 'è®©æˆ‘æƒ³æƒ³...'
      },
      [State.ENDING]: {
        icon: 'ğŸ‘‹',
        text: 'ç»“æŸå¯¹è¯',
        btnClass: 'ending',
        face: 'ğŸ˜Š',
        hint: 'å†ç‚¹ä¸€ä¸‹ç»“æŸ'
      }
    };

    function setState(state) {
      currentState = state;
      const c = config[state];

      mainBtn.className = `main-btn ${c.btnClass}`;
      btnIcon.textContent = c.icon;
      btnText.textContent = c.text;
      aiFace.textContent = c.face;
      aiText.textContent = c.hint;

      // AI æŒ‡ç¤ºå™¨çŠ¶æ€
      aiDot.className = 'ai-indicator-dot';
      if (state === State.LISTENING) aiDot.classList.add('listening');
      if (state === State.SPEAKING) aiDot.classList.add('speaking');

      // è§¦è§‰åé¦ˆ
      if ('vibrate' in navigator) {
        if (state === State.LISTENING) navigator.vibrate(30);
        if (state === State.SPEAKING) navigator.vibrate([15, 20, 15]);
      }
    }

    function handleAction() {
      if (!isActive) {
        // å¼€å§‹å¯¹è¯
        isActive = true;

        // æ‹ç…§é—ªå…‰
        flash.classList.add('active');
        setTimeout(() => flash.classList.remove('active'), 200);

        setTimeout(() => {
          setState(State.LISTENING);

          // æ¨¡æ‹Ÿ AI å›å¤
          setTimeout(() => {
            setState(State.SPEAKING);
            setTimeout(() => setState(State.LISTENING), 3000);
          }, 3000);
        }, 300);

      } else if (currentState === State.ENDING) {
        // ç¡®è®¤ç»“æŸ
        isActive = false;
        setState(State.IDLE);
      } else {
        // å‡†å¤‡ç»“æŸ
        setState(State.ENDING);
      }
    }

    function goHome() {
      if ('vibrate' in navigator) navigator.vibrate(15);
      window.location.href = 'index.html';
    }

    // åˆå§‹åŒ–
    setState(State.IDLE);
  </script>
</body>
</html>
