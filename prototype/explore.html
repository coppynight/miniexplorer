<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>MiniExplorer - æ¢ç´¢æ¨¡å¼</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* æ¢ç´¢æ¨¡å¼ç‰¹å®šæ ·å¼ */

    /* ç›¸æœºåŒºåŸŸæ¨¡æ‹ŸçœŸå®ç›¸æœºç”»é¢ */
    .camera-preview-fullscreen {
      background:
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><linearGradient id="sky" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%2387CEEB"/><stop offset="60%" style="stop-color:%23E0F4FF"/><stop offset="100%" style="stop-color:%2398D8AA"/></linearGradient></defs><rect fill="url(%23sky)" width="100" height="100"/></svg>'),
        linear-gradient(180deg, #87CEEB 0%, #E0F4FF 60%, #98D8AA 100%);
      background-size: cover;
    }

    /* æ¨¡æ‹Ÿç›¸æœºå–æ™¯æ¡†æ•ˆæœ */
    .camera-frame {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .camera-frame::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      bottom: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
    }

    /* å¯¹ç„¦åŠ¨ç”» */
    .focus-indicator {
      position: absolute;
      width: 80px;
      height: 80px;
      border: 2px solid rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .focus-indicator.active {
      opacity: 1;
      animation: focus-pulse 0.8s ease-out;
    }

    @keyframes focus-pulse {
      0% {
        transform: scale(1.3);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    /* æ¢ç´¢æç¤ºæ°”æ³¡ */
    .explore-hint {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      font-weight: 600;
      color: var(--color-text);
      opacity: 0;
      animation: hint-appear 0.5s ease 1s forwards;
      z-index: 15;
    }

    .explore-hint::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 10px solid rgba(255, 255, 255, 0.95);
    }

    @keyframes hint-appear {
      0% {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
      }
      100% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    /* æ¨¡æ‹Ÿåœºæ™¯ä¸­çš„ç‰©ä½“ */
    .scene-objects {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .scene-object {
      position: absolute;
      font-size: 40px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
      animation: float 4s ease-in-out infinite;
    }

    .scene-object:nth-child(1) {
      top: 25%;
      left: 15%;
      font-size: 50px;
      animation-delay: 0s;
    }

    .scene-object:nth-child(2) {
      top: 40%;
      right: 20%;
      font-size: 35px;
      animation-delay: 1s;
    }

    .scene-object:nth-child(3) {
      top: 55%;
      left: 25%;
      font-size: 45px;
      animation-delay: 2s;
    }

    .scene-object:nth-child(4) {
      top: 35%;
      left: 60%;
      font-size: 30px;
      animation-delay: 0.5s;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      25% {
        transform: translateY(-8px) rotate(3deg);
      }
      75% {
        transform: translateY(5px) rotate(-3deg);
      }
    }

    /* å£°æ³¢åŠ¨ç”»ï¼ˆå¯¹è¯ä¸­ï¼‰ */
    .sound-waves {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sound-waves.active {
      opacity: 1;
    }

    .sound-wave {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      border: 3px solid var(--color-success);
      border-radius: 50%;
      opacity: 0;
    }

    .sound-waves.active .sound-wave {
      animation: wave-expand 2s ease-out infinite;
    }

    .sound-wave:nth-child(2) {
      animation-delay: 0.4s;
    }

    .sound-wave:nth-child(3) {
      animation-delay: 0.8s;
    }

    @keyframes wave-expand {
      0% {
        width: 60px;
        height: 60px;
        opacity: 0.6;
      }
      100% {
        width: 150px;
        height: 150px;
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- å®‰å…¨åŒºåŸŸé¡¶éƒ¨ -->
    <div class="safe-area-top"></div>

    <!-- ç›¸æœºé¢„è§ˆåŒºåŸŸ -->
    <div class="camera-area">
      <div class="camera-preview-fullscreen">
        <!-- æ¨¡æ‹Ÿç›¸æœºç”»é¢ä¸­çš„ç‰©ä½“ -->
        <div class="scene-objects">
          <span class="scene-object">ğŸŒ¸</span>
          <span class="scene-object">ğŸ¦‹</span>
          <span class="scene-object">ğŸŒ»</span>
          <span class="scene-object">ğŸ</span>
        </div>

        <!-- ç›¸æœºå–æ™¯æ¡† -->
        <div class="camera-frame"></div>

        <!-- å¯¹ç„¦æŒ‡ç¤ºå™¨ -->
        <div class="focus-indicator" id="focusIndicator"></div>

        <!-- æ¢ç´¢æç¤º -->
        <div class="explore-hint" id="exploreHint">
          ğŸ‘€ ç‚¹ä¸€ç‚¹æƒ³çœ‹çš„ä¸œè¥¿
        </div>
      </div>

      <!-- AI å°çƒæ‚¬æµ® -->
      <div class="ai-avatar ai-avatar-floating">
        <div class="ai-bubble happy" id="aiBubble">
          <span class="ai-face" id="aiFace">ğŸ˜Š</span>
        </div>
        <!-- å£°æ³¢åŠ¨ç”» -->
        <div class="sound-waves" id="soundWaves">
          <div class="sound-wave"></div>
          <div class="sound-wave"></div>
          <div class="sound-wave"></div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨æ§åˆ¶åŒº -->
    <div class="control-area">
      <!-- ä¸»æŒ‰é’® -->
      <button class="main-button idle" id="mainButton" onclick="handleMainButtonClick()">
        <span class="main-button-icon" id="buttonIcon">ğŸ¤</span>
        <span id="buttonText">è¯´è¯</span>
        <div class="ripple-container" id="rippleContainer"></div>
      </button>

      <!-- Tab æ  -->
      <div class="tab-bar">
        <button class="tab-item active" onclick="switchTab('explore')">
          <span class="tab-icon">ğŸ”</span>
          <span class="tab-label">çœ‹çœ‹</span>
        </button>
        <button class="tab-item inactive" onclick="switchTab('companion')">
          <span class="tab-icon">ğŸ˜Š</span>
          <span class="tab-label">èŠå¤©</span>
        </button>
      </div>
    </div>

    <!-- å®‰å…¨åŒºåŸŸåº•éƒ¨ -->
    <div class="safe-area-bottom"></div>

    <!-- æ‹ç…§é—ªå…‰ -->
    <div class="flash-overlay" id="flashOverlay"></div>
  </div>

  <script>
    // çŠ¶æ€ç®¡ç†
    const State = {
      IDLE: 'idle',           // ç©ºé—² - è¯´è¯
      LISTENING: 'listening', // å¯¹è¯ä¸­ - å¬ç€å‘¢
      SPEAKING: 'speaking',   // AIå›å¤ - ç­‰ç­‰æˆ‘
      ENDING: 'ending'        // ç»“æŸ - æ‹œæ‹œ
    };

    let currentState = State.IDLE;
    let conversationActive = false;
    let longPressTimer = null;

    // å…ƒç´ å¼•ç”¨
    const mainButton = document.getElementById('mainButton');
    const buttonIcon = document.getElementById('buttonIcon');
    const buttonText = document.getElementById('buttonText');
    const aiBubble = document.getElementById('aiBubble');
    const aiFace = document.getElementById('aiFace');
    const flashOverlay = document.getElementById('flashOverlay');
    const soundWaves = document.getElementById('soundWaves');
    const rippleContainer = document.getElementById('rippleContainer');
    const exploreHint = document.getElementById('exploreHint');
    const focusIndicator = document.getElementById('focusIndicator');

    // çŠ¶æ€é…ç½®
    const stateConfig = {
      [State.IDLE]: {
        icon: 'ğŸ¤',
        text: 'è¯´è¯',
        buttonClass: 'idle',
        face: 'ğŸ˜Š',
        bubbleClass: 'happy'
      },
      [State.LISTENING]: {
        icon: 'ğŸµ',
        text: 'å¬ç€å‘¢',
        buttonClass: 'listening',
        face: 'ğŸ˜®',
        bubbleClass: 'listening'
      },
      [State.SPEAKING]: {
        icon: 'ğŸ˜Š',
        text: 'ç­‰ç­‰æˆ‘',
        buttonClass: 'speaking',
        face: 'ğŸ¥°',
        bubbleClass: 'speaking'
      },
      [State.ENDING]: {
        icon: 'ğŸ‘‹',
        text: 'æ‹œæ‹œ',
        buttonClass: 'ending',
        face: 'ğŸ˜´',
        bubbleClass: 'sleep'
      }
    };

    // æ›´æ–°UIçŠ¶æ€
    function updateState(newState) {
      currentState = newState;
      const config = stateConfig[newState];

      // æ›´æ–°æŒ‰é’®
      mainButton.className = `main-button ${config.buttonClass}`;
      buttonIcon.textContent = config.icon;
      buttonText.textContent = config.text;

      // æ›´æ–°AIå½¢è±¡
      aiBubble.className = `ai-bubble ${config.bubbleClass}`;
      aiFace.textContent = config.face;

      // å£°æ³¢åŠ¨ç”»
      soundWaves.classList.toggle('active', newState === State.LISTENING);

      // è§¦è§‰åé¦ˆæ¨¡æ‹Ÿ
      vibrate(newState);
    }

    // è§¦è§‰åé¦ˆæ¨¡æ‹Ÿ
    function vibrate(state) {
      if ('vibrate' in navigator) {
        switch (state) {
          case State.LISTENING:
            navigator.vibrate(50);
            break;
          case State.SPEAKING:
            navigator.vibrate([20, 30, 20]);
            break;
          case State.ENDING:
            navigator.vibrate(30);
            break;
        }
      }
    }

    // ä¸»æŒ‰é’®ç‚¹å‡»å¤„ç†
    function handleMainButtonClick() {
      createRipple(event);

      if (!conversationActive) {
        // å¼€å§‹å¯¹è¯
        startConversation();
      } else if (currentState === State.ENDING) {
        // ç¡®è®¤ç»“æŸ
        endConversation();
      } else {
        // åˆ‡æ¢åˆ°ç»“æŸçŠ¶æ€
        updateState(State.ENDING);
      }
    }

    // å¼€å§‹å¯¹è¯
    function startConversation() {
      conversationActive = true;

      // éšè—æç¤º
      exploreHint.style.opacity = '0';

      // æ‹ç…§é—ªå…‰æ•ˆæœ
      flashOverlay.classList.add('active');
      setTimeout(() => flashOverlay.classList.remove('active'), 200);

      // åˆ‡æ¢åˆ°è†å¬çŠ¶æ€
      setTimeout(() => {
        updateState(State.LISTENING);

        // æ¨¡æ‹ŸAIå›å¤ï¼ˆæ¼”ç¤ºç”¨ï¼‰
        setTimeout(() => {
          updateState(State.SPEAKING);

          // æ¨¡æ‹Ÿå›å¤ç»“æŸ
          setTimeout(() => {
            updateState(State.LISTENING);
          }, 3000);
        }, 4000);
      }, 300);
    }

    // ç»“æŸå¯¹è¯
    function endConversation() {
      conversationActive = false;
      updateState(State.IDLE);

      // é‡æ–°æ˜¾ç¤ºæç¤º
      setTimeout(() => {
        exploreHint.style.opacity = '1';
      }, 1000);
    }

    // æ³¢çº¹æ•ˆæœ
    function createRipple(e) {
      const rect = mainButton.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const ripple = document.createElement('div');
      ripple.className = 'ripple';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';

      rippleContainer.appendChild(ripple);

      setTimeout(() => ripple.remove(), 600);
    }

    // åˆ‡æ¢Tab
    function switchTab(tab) {
      if (tab === 'companion') {
        window.location.href = 'companion.html';
      }
    }

    // ç›¸æœºåŒºåŸŸç‚¹å‡»ï¼ˆå¯¹ç„¦æ•ˆæœï¼‰
    document.querySelector('.camera-preview-fullscreen').addEventListener('click', (e) => {
      const rect = e.currentTarget.getBoundingClientRect();
      const x = e.clientX - rect.left - 40;
      const y = e.clientY - rect.top - 40;

      focusIndicator.style.left = x + 'px';
      focusIndicator.style.top = y + 'px';
      focusIndicator.classList.remove('active');

      // è§¦å‘é‡ç»˜
      void focusIndicator.offsetWidth;

      focusIndicator.classList.add('active');

      // éœ‡åŠ¨åé¦ˆ
      if ('vibrate' in navigator) {
        navigator.vibrate(10);
      }
    });

    // é•¿æŒ‰æ£€æµ‹ï¼ˆç”¨äºç»“æŸå¯¹è¯ï¼‰
    mainButton.addEventListener('touchstart', () => {
      if (conversationActive && currentState !== State.ENDING) {
        longPressTimer = setTimeout(() => {
          updateState(State.ENDING);
        }, 800);
      }
    });

    mainButton.addEventListener('touchend', () => {
      clearTimeout(longPressTimer);
    });

    mainButton.addEventListener('touchcancel', () => {
      clearTimeout(longPressTimer);
    });

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      updateState(State.IDLE);
    });
  </script>
</body>
</html>
